<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.VeMapper">
	<resultMap id="resultMapVe"
		type="com.example.demo.model.Ve">
		<result column="IdVe" property="IdVe" />
		<result column="GiaVe" property="GiaVe" />
		<result column="ThueVat" property="ThueVat" />
		<result column=" MaKH" property="MaKH" />
		<result column="MaCTGhe" property="MaCTGhe" />
		<result column="MaNV" property="MaNV" />
		<result column="MaPhim" property="MaPhim" />
		<result column="TenPhim" property="TenPhim" />	
		<result column="Soluong" property="Soluong" />	
		<result column="ngay" property="ngay" />	
		<result column="tong" property="tong" />
		<result column="tenkh" property="tenkh" />
		<result column="giobatdau" property="giobatdau" />
	</resultMap>
	<select id="getAllVe1" resultMap="resultMapVe">
	select phim.maphim,phim.tenphim, count(ve.idve) as Soluong, sum(ve.tonggiave) as tong, xuatchieu.ngay from ve left join chitietghe ON chitietghe.mactghe = ve.mactghe left join xuatchieu ON xuatchieu.maphong = chitietghe.maphong left join phim on phim.maphim = xuatchieu.maphim where phim.maphim=#{maPhim} group by phim.maphim,xuatchieu.ngay

	</select>

	<select id="getLichSuVe" resultMap="resultMapVe">
select khachhang.makh,khachhang.tenkh,phim.tenphim,ve.idve,ngaychieu.ngay,ngaychieu.giobatdau from ve join khachhang on khachhang.makh = ve.makh
 join chitietghe on chitietghe.mactghe = ve.mactghe join phongchieu on phongchieu.maphong = chitietghe.maphong
 join xuatchieu on xuatchieu.maphong = phongchieu.maphong join ngaychieu on ngaychieu.stt = xuatchieu.ngay
 join phim ON phim.maphim = xuatchieu.maphim
where xuatchieu.stt = ve.stt_xc and ve.makh=#{maKH}
	</select>
	<select id="getAllVe" resultMap="resultMapVe">
			select * from ve

	</select>
	<insert id="insertVe">
	insert into Ve(GiaVe, ThueVat, MaCTGhe, MaKH,stt_xc) values(#{giaVe},#{thueVat},#{maCTGhe},#{maKH},#{stt_xc})
	</insert>
	<select id="getVe" resultMap="resultMapVe">
		select tenkh,GiaVe, TenPhim
		from Ve join KhachHang on KhachHang.maKH = Ve.maKH
		right join ChiTietGhe on ChiTietGhe.maCTGhe = Ve.maCTGhe
		join PhongChieu on PhongChieu.maPhong = ChiTietGhe.maPhong
		join xuatchieu on xuatchieu.maPhong = PhongChieu.maPhong
		join Phim on Phim.maPhim = xuatchieu.maPhim
		where idVe = #{idVe}and xuatchieu.stt = Ve.stt_xc
	</select>
</mapper>